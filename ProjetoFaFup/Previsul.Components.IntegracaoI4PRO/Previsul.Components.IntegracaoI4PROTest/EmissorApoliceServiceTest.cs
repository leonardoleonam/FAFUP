using Application.Domain.Interfaces.Infrastructure.Integrations.I4Pro;
using Application.Integration.I4Pro.Services;
using Application.Integration.I4Pro.Services.Handler;
using RestSharp;
using Xunit;

namespace Previsul.Components.IntegracaoI4PROTest
{
    public class EmissorApoliceServiceTest
    {
        IEmissorApoliceService EmissorApoliceService { get; }

        public EmissorApoliceServiceTest()
        {

        }

        [Fact]
        public void Deve_Emitir_Apolice()
        {
            var handler = new I4ProServiceHandler(new AutenticadorTokenService(new RestClient()), new RestClient());
            var servico = new EmissorApoliceService(new RestClient(), handler);

            var dados = servico.EmitirApolice("{\"apolice\":{\"cd_externo\":3,\"cd_corretor\":2255,\"dt_inicio_vigencia\":\"20180810\",\"dv_prazo_curto\":0,\"nr_meses_vigencia\":12,\"dt_fim_vigencia\":\"20190809\",\"cd_proposta\":\"8702018\",\"id_orgao\":1,\"id_parceria\":1,\"id_canal_venda\":99,\"dv_negociacao\":0,\"dv_contrato_outra_seguradora\":0,\"dv_encampacao\":0,\"id_ise\":2,\"cd_tipo_pessoa\":2,\"id_sexo\":1,\"nm_pessoa\":\"2018 COMUNICACAO SPE LTDA\",\"nr_cnpj_cpf\":\"30519418000170\",\"cd_ramo_atividade\":\"7311400\",\"nm_endereco\":\"R REPUBLICA ARGENTINA N.211\",\"nr_rua_endereco\":\"211\",\"nm_bairro\":\"SION\",\"nm_cidade\":\"BELO HORIZONTE\",\"nm_cep\":\"30315490\",\"nm_sigla_uf\":\"MG\",\"nm_email\":\"JOAOVICTOR@VITORIACI.COM.BR\",\"dv_grupo_faturamento\":0,\"sub\":[{\"cd_tipo_pessoa\":2,\"id_sexo\":1,\"nm_pessoa\":\"2018 COMUNICACAO SPE LTDA\",\"nr_cnpj_cpf\":\"30519418000170\",\"nm_endereco\":\"R REPUBLICA ARGENTINA N.211\",\"nr_rua_endereco\":\"211\",\"nm_bairro\":\"SION\",\"nm_cidade\":\"BELO HORIZONTE\",\"nm_cep\":\"30315490\",\"nm_sigla_uf\":\"MG\",\"nm_email\":\"JOAOVICTOR@VITORIACI.COM.BR\",\"dt_primeiro_inicio_vigencia\":\"20180810\",\"cd_forma_pagamento\":9,\"nr_dia_vencimento\":15,\"nr_dia_corte\":5,\"nr_meses_dia_corte_vigencia\":12,\"id_pacote_regra\":1150,\"dv_tipo_risco\":1,\"dv_tipo_risco_individual\":0,\"id_tp_classe_seguro\":1,\"id_classe_sub_estipulante\":2,\"id_tp_vigencia\":4,\"dv_emite_certificado\":1,\"dv_emite_cert_seg_via\":1,\"dv_certificado_inclusao\":1,\"dv_certificado_correcao_reenquadramento\":1,\"dv_certificado_alteracao\":1,\"dv_certificado_renovacao\":1,\"vl_premio_minimo\":5.00,\"pe_sub_estipulante\":100.00,\"pe_participante\":0.00,\"nr_vida\":55,\"nr_meses_tipo_risco\":1,\"kitformularios\":[{\"nm_kit\":\"KIT ESTIPULANTE\",\"cd_tp_impressao\":2,\"cd_formularios\":\"0000020; 1000043; 1000044; 1000085; 1000105; 1000114\",\"dv_cartao_assistencia\":0,\"dv_cartao_vantagem\":0},{\"nm_kit\":\"KIT SEGURADO\",\"cd_tp_impressao\":3,\"cd_formularios\":\"1000085\",\"dv_cartao_assistencia\":1,\"dv_cartao_vantagem\":0,\"dv_usa_parametros_do_sub\":0,\"dv_emite_certificado\":1,\"dv_emite_cert_seg_via\":1,\"dv_certificado_inclusao\":1,\"dv_certificado_correcao_reenquadramento\":1,\"dv_certificado_alteracao\":1,\"dv_certificado_renovacao\":1,\"dv_carta_boleto\":0,\"dv_certificado_primeiro_pagto\":0,\"cd_tp_sub_impressao\":\"CFVP\",\"dv_enviar_para\":\"EST\"}],\"modulos\":[{\"cd_plano\":0,\"nm_descricao_sub\":\"Plano Único Cota + \",\"id_periodo_taxa\":1,\"id_periodo_vigencia\":1,\"coberturas\":[{\"cd_externo_cob\":763,\"id_tp_forma_capital\":2,\"vl_tp_forma_capital\":\"200000.00\",\"nr_grupo_percentual_basica\":0,\"dv_reajusta\":1,\"dv_reenquadra\":1,\"dv_renova\":1,\"pe_cobertura_pai\":100,\"nr_idade_minima\":66,\"nr_idade_minima_implantacao\":66,\"nr_idade_maxima\":70,\"nr_idade_maxima_implantacao\":70,\"vl_limite_minimo\":200000.00,\"vl_limite_indenizacao\":200000.00,\"dv_taxa_com_iof\":1,\"cd_indicador_reajuste\":3,\"dv_adota_limite_estouro\":0,\"nr_diarias_franquia\":0},{\"cd_externo_cob\":764,\"id_tp_forma_capital\":8,\"vl_tp_forma_capital\":\"\",\"nr_grupo_percentual_basica\":12,\"dv_reajusta\":1,\"dv_reenquadra\":1,\"dv_renova\":1,\"pe_cobertura_pai\":100,\"nr_idade_minima\":66,\"nr_idade_minima_implantacao\":66,\"nr_idade_maxima\":70,\"nr_idade_maxima_implantacao\":70,\"vl_limite_minimo\":200000.00,\"vl_limite_indenizacao\":200000.00,\"dv_taxa_com_iof\":1,\"cd_indicador_reajuste\":3,\"dv_adota_limite_estouro\":0,\"nr_diarias_franquia\":0},{\"cd_externo_cob\":766,\"id_tp_forma_capital\":8,\"vl_tp_forma_capital\":\"\",\"nr_grupo_percentual_basica\":12,\"dv_reajusta\":1,\"dv_reenquadra\":1,\"dv_renova\":1,\"pe_cobertura_pai\":5,\"nr_idade_minima\":66,\"nr_idade_minima_implantacao\":66,\"nr_idade_maxima\":70,\"nr_idade_maxima_implantacao\":70,\"vl_limite_minimo\":10000.00,\"vl_limite_indenizacao\":10000.00,\"dv_taxa_com_iof\":1,\"cd_indicador_reajuste\":3,\"dv_adota_limite_estouro\":0,\"nr_diarias_franquia\":0},{\"cd_externo_cob\":1106,\"id_tp_forma_capital\":2,\"vl_tp_forma_capital\":0.00,\"dv_reajusta\":0,\"dv_reenquadra\":0,\"dv_renova\":1,\"pe_cobertura_pai\":100.00,\"nr_idade_minima\":66,\"nr_idade_minima_implantacao\":66,\"nr_idade_maxima\":70,\"nr_idade_maxima_implantacao\":70,\"vl_limite_minimo\":0,\"vl_limite_indenizacao\":0,\"vl_custo\":1.57,\"dv_taxa_com_iof\":1,\"cd_indicador_reajuste\":3,\"nr_diarias\":\"\",\"dv_adota_limite_estouro\":\"\",\"nm_obs_certificado\":\"\",\"nr_diarias_carencia\":\"\",\"nr_diarias_franquia\":\"\",\"nr_grupo_percentual_basica\":0}],\"taxascoberturas\":[{\"cd_externo_cob\":766,\"id_tabela_campo_parametro\":4,\"vl_inicial\":0.00,\"vl_final\":115,\"nm_obs_range\":\"Idade de 0 a 115 anos\",\"vl_campo\":0.057581},{\"cd_externo_cob\":764,\"id_tabela_campo_parametro\":4,\"vl_inicial\":0.00,\"vl_final\":115,\"nm_obs_range\":\"Idade de 0 a 115 anos\",\"vl_campo\":0.005281},{\"cd_externo_cob\":763,\"id_tabela_campo_parametro\":4,\"vl_inicial\":0.00,\"vl_final\":115,\"nm_obs_range\":\"Idade de 0 a 115 anos\",\"vl_campo\":0.044878}],\"comissaosub\":[{\"cd_tp_comissao\":2,\"nr_grupo\":12,\"cd_corretor\":2255,\"pe_comissao\":50.000000,\"pe_participacao\":100.00,\"dv_lider\":1,\"dv_sobre_inclusoes\":0,\"dv_competencia\":0,\"dv_agenciamento_sobre_incremento_capital\":0,\"dv_descontado\":0,\"dv_cancelado\":0,\"nr_parcela_inicial\":1,\"nr_parcela_final\":99999}]}]}]}}");            
        }
    }
}
